---
title: "Small R Functions"
author: "JÃ¶rn Alexander Quent"
date: "24 January 2018"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
options(scipen = 30)
```

## General
I will collect R function that I wrote in this file, which are too random or small to make a package, but still useful. You can just copy and paste them into your scripts to use them. 

## progressDisplay
This function can be used to display the progress in a for loop. I hate it when I don't see how many steps have been completed. Therefore I create this small function.

```{r,  include = TRUE, eval = FALSE}
# Function
progressDisplay <- function(i, iterations){
  cat('\rProgress: |',rep('=',floor((i/iterations)*50)),rep(' ',50 - floor((i/iterations)*50)),'|', sep = '')
}

# Usage
iterations <- 100
for(i in 1:iterations){
  progressDisplay(i, iterations)
}
```

## pValue
I use this function to report p-values in my texts, captions or figures. This function can be used on raw *p*-values as well as to extract *p*-values from *lm* variables.
```{r, include = TRUE}
# Function
pValue <-function(x, sign = '='){
  if (inherits(x, "lm")){
    s <- summary.lm(x)
    x <- pf(s$fstatistic[1L], s$fstatistic[2L], s$fstatistic[3L], lower.tail = FALSE)
    if(x > 1){
      stop("There is no p-value greater than 1")
    } else if(x < 0.001){
      x.converted <- '< .001'
    } else{
      x.converted <- paste(sign,substr(as.character(round(x, 3)), 2,5))
    } 
  } else {
    if(x > 1){
      stop("There is no p-value greater than 1")
    } else if(x < 0.001){
      x.converted <- '< .001'
    } else{
      x.converted <- paste(sign,substr(as.character(round(x, 3)), 2,5))
    } 
  }
  return(x.converted)
}

# Raw p-values
p1    <- 0.03739
p2    <- 0.0936
p3    <- 0.00083
p4    <- 0.82788

# LM object
a     <- runif(10)
b     <- runif(10)
model <- lm(a ~ b)

# Usage: The mean of A is significantly different from B, *p* `r pValue(p1)`, and C, *p* `r pValue(p3)`, but the means of B and C are not significantly different, *p* `r pValue(p2)`. Note that all *p*s `r pValue(p4, '>')`. The linear regression model is significant, *p* `r pValue(model)`.
```

The mean of A is significantly different from B, *p* `r pValue(p1)`, and C, *p* `r pValue(p3)`, but the means of B and C are not significantly different, *p* `r pValue(p2)`. Note that all *p*s `r pValue(p4, '>')`. The linear regression model is not significant, *p* `r pValue(model)`.

## rValue
I use this function mainly to report correlation coefficents or $r^2$ in my texts, captions or figures.

```{r}
# Function
rValue <-function(x){
  if (inherits(x, "lm")){
    r.squared <- summary(x)$r.squared
    x.converted <- paste('=',substr(as.character(round(r.squared, 3)), 2,5)) 
  } else {
    if (x < 0){
      x.converted <- paste('= -',substr(as.character(abs(round(x, 3))), 2,5), sep = '') 
    } else {
      x.converted <- paste('=',substr(as.character(abs(round(x, 3))), 2,5)) 
    }
  }
  return(x.converted) 
}

correlation <- cor.test(a, b)
# Usage: The model doesn't explains a lot of variance, $r^2$ `r rValue(model)`. The correlation is also high, *r* `r rValue(correlation$estimate)`.
```

The model doesn't explains a lot of variance, $r^2$ `r rValue(model)`. The correlation is also not very high, *r* `r rValue(correlation$estimate)`.
