---
title: "Rating Study"
author: "Joern Alexander Quent"
date: "10 January 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Introduction
On Friday I found a good combination of objects and locations (see [here](https://jaquent.github.io/2018/0112_stimulusSelection.html)). Before I try this set in VR, it is important to make sure that the foils are not different from the targets in terms of the expectancy. To compare those, I calulate a repeated measure ANOVA and visualise it.  

## Used libraries and functions
```{r}
library(ggplot2)
library(ez)
library(tidyr)

pValue <-function(x, sign = '='){
  if (inherits(x, "lm")){
    s <- summary.lm(x)
    x <- pf(s$fstatistic[1L], s$fstatistic[2L], s$fstatistic[3L], lower.tail = FALSE)
    if(x > 1){
      stop("There is no p-value greater than 1")
    } else if(x < 0.001){
      x.converted <- '< .001'
    } else{
      x.converted <- paste(sign,substr(as.character(round(x, 3)), 2,5))
    } 
  } else {
    if(x > 1){
      stop("There is no p-value greater than 1")
    } else if(x < 0.001){
      x.converted <- '< .001'
    } else{
      x.converted <- paste(sign,substr(as.character(round(x, 3)), 2,5))
    } 
  }
  return(x.converted)
}

rValue <-function(x){
  if (inherits(x, "lm")){
    r.squared <- summary(x)$r.squared
    x.converted <- paste('=',substr(as.character(round(r.squared, 3)), 2,5)) 
  } else {
    if (x < 0){
      x.converted <- paste('= -',substr(as.character(abs(round(x, 3))), 2,5), sep = '') 
    } else {
      x.converted <- paste('=',substr(as.character(abs(round(x, 3))), 2,5)) 
    }
  }
  return(x.converted) 
}
```

## Formating data
```{r}
# Loading data
data <- read.table('finalSelection.txt', header = TRUE, sep = '\t')
head(data)

# Converting data to long format
dataLong <- gather(data, Type, Rank, olRank, foil1Rank, foil2Rank)
head(dataLong)
```

## ANOVA
```{r}
resultANOVA <- ezANOVA(data = dataLong, dv = .(Rank), wid = .(Object), within = .(Type), detailed = TRUE)
resultANOVA
```

Type (target vs. foil 1 vs. foil 2) has no significant effect on the ranks, *F*(`r resultANOVA$ANOVA[2,'DFn']`, `r resultANOVA$ANOVA[2,'DFd']`) = `r round(resultANOVA$ANOVA[2,'F'],2)`, *p* `r pValue(resultANOVA$ANOVA[2,'p'])`.

## Visualisation
```{r}
ggplot(data = dataLong, aes(x = Type, y = Rank)) + geom_jitter(width = 0.2)
```

## Conclusion
Both the ANOVA and the visualiasation shows that the ranks of targets and foils do not differ from eachother. Therefore the next step is to try the set in VR. 